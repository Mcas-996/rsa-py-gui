import { Button, VerticalBox, HorizontalBox, TextEdit, GroupBox, StandardListView } from "std-widgets.slint";

export component AppWindow inherits Window {
    in-out property<string> plaintext: "";
    in-out property<string> ciphertext: "";
    in-out property<string> status: "生成密钥后开始使用";
    in-out property<bool> has-keys: false;
    in-out property<[StandardListViewItem]> ciphertext-items: [];

    callback generate-keys();
    callback encrypt-text(string);
    callback decrypt-text(string);
    callback save-keys();
    callback load-keys();
    callback save-ciphertext-bin();
    callback get-ciphertext-list();
    callback load-ciphertext-file(string);

    VerticalBox {
        padding: 15px;
        spacing: 10px;

        // 状态栏
        Text {
            text: status;
            color: has-keys ? #2e7d32 : #c62828;
            horizontal-alignment: center;
        }

        // 密钥管理按钮
        HorizontalBox {
            spacing: 10px;
            Button {
                text: "生成密钥";
                clicked => { root.generate-keys(); }
            }
            Button {
                text: "保存密钥";
                clicked => { root.save-keys(); }
                enabled: has-keys;
            }
            Button {
                text: "加载密钥";
                clicked => { root.load-keys(); }
            }
        }

        // 明文和密文输入框并排
        HorizontalBox {
            spacing: 10px;
            GroupBox {
                title: "明文";
                TextEdit {
                    text <=> root.plaintext;
                    placeholder-text: "输入要加密的文本";
                    wrap: word-wrap;
                }
            }
            GroupBox {
                title: "密文 (Base64)";
                TextEdit {
                    text <=> root.ciphertext;
                    placeholder-text: "输入要解密的 Base64 密文";
                    wrap: word-wrap;
                }
            }
        }

        // 操作按钮
        HorizontalBox {
            spacing: 10px;
            Button {
                text: "加密 >";
                clicked => { root.encrypt-text(root.plaintext); }
                enabled: has-keys && plaintext != "";
            }
            Button {
                text: "保存密文";
                clicked => { root.save-ciphertext-bin(); }
            }
            Button {
                text: "刷新列表";
                clicked => { root.get-ciphertext-list(); }
            }
            Button {
                text: "加载密文";
                clicked => {
                    root.load-ciphertext-file(root.ciphertext-items[root.ciphertext-items.length - 1].text);
                }
                enabled: has-keys && ciphertext-items.length > 0;
            }
            Button {
                text: "< 解密";
                clicked => { root.decrypt-text(root.ciphertext); }
                enabled: has-keys && ciphertext != "";
            }
        }

        // 密文文件列表
        Text {
            text: "已保存的密文文件:";
        }
        StandardListView {
            model: ciphertext-items;
            height: 100px;
        }
    }
}