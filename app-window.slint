import { Button, VerticalBox, HorizontalBox, TextEdit, GroupBox, StandardListView } from "std-widgets.slint";

export component AppWindow inherits Window {
    in-out property<string> plaintext: "";
    in-out property<string> ciphertext: "";
    in-out property<string> status: "Generate keys to start";
    in-out property<string> preview-status: "";
    in-out property<bool> has-keys: false;
    in-out property<[StandardListViewItem]> ciphertext-items: [];

    callback generate-keys();
    callback encrypt-text(string);
    callback decrypt-text(string);
    callback save-keys();
    callback load-keys();
    callback save-ciphertext-bin();
    callback get-ciphertext-list();
    callback load-ciphertext-file(string);

    VerticalBox {
        padding: 15px;
        spacing: 10px;

        // Status bar
        Text {
            text: status;
            color: has-keys ? #2e7d32 : #c62828;
            horizontal-alignment: center;
        }

        // Key management buttons
        HorizontalBox {
            spacing: 10px;
            Button {
                text: "Generate Keys";
                clicked => { root.generate-keys(); }
            }
            Button {
                text: "Save Keys";
                clicked => { root.save-keys(); }
                enabled: has-keys;
            }
            Button {
                text: "Load Keys";
                clicked => { root.load-keys(); }
            }
        }

        // Plaintext and ciphertext inputs side by side
        HorizontalBox {
            spacing: 10px;
            GroupBox {
                title: "Plaintext";
                TextEdit {
                    text <=> root.plaintext;
                    placeholder-text: "Enter text to encrypt";
                    wrap: word-wrap;
                }
            }
            GroupBox {
                title: "Ciphertext (Base64)";
                TextEdit {
                    text <=> root.ciphertext;
                    placeholder-text: "Enter Base64 ciphertext to decrypt";
                    wrap: word-wrap;
                }
            }
        }

        // Preview status hint
        HorizontalBox {
            spacing: 10px;
            Text {
                text: "Preview:";
                font-weight: 700;
            }
            Text {
                text: root.preview-status;
                color: root.preview-status != "" ? #2e7d32 : #666666;
                font-size: 12px;
            }
        }

        // Action buttons
        HorizontalBox {
            spacing: 10px;
            Button {
                text: "Encrypt >";
                clicked => { root.encrypt-text(root.plaintext); }
                enabled: has-keys && plaintext != "";
            }
            Button {
                text: "Save Ciphertext";
                clicked => { root.save-ciphertext-bin(); }
            }
            Button {
                text: "Refresh List";
                clicked => { root.get-ciphertext-list(); }
            }
            Button {
                text: "Load Ciphertext";
                clicked => {
                    root.load-ciphertext-file(root.ciphertext-items[root.ciphertext-items.length - 1].text);
                }
                enabled: has-keys && ciphertext-items.length > 0;
            }
            Button {
                text: "< Decrypt";
                clicked => { root.decrypt-text(root.ciphertext); }
                enabled: has-keys && ciphertext != "";
            }
        }

        // Ciphertext file list
        Text {
            text: "Saved ciphertext files:";
        }
        StandardListView {
            model: ciphertext-items;
            height: 100px;
        }
    }
}
