import { Button, VerticalBox, HorizontalBox, TextEdit, GroupBox, StandardListView, Switch, TabWidget, ComboBox, LineEdit } from "std-widgets.slint";

export component AppWindow inherits Window {
    in-out property<string> plaintext: "";
    in-out property<string> ciphertext: "";
    in-out property<string> status: "Generate keys to start";
    in-out property<string> preview-status: "";
    in-out property<bool> has-keys: false;
    in-out property<bool> preview-enabled: true;
    in-out property<[StandardListViewItem]> ciphertext-items: [];

    // File tab properties
    in-out property<string> selected-file: "";
    in-out property<string> selected-cipher: "";
    in-out property<string> file-info: "";
    in-out property<string> file-progress: "";
    in-out property<float> progress-value: 0;
    in-out property<string> file-status: "";
    in-out property<[StandardListViewItem]> rsa-file-items: [];

    // Settings
    in-out property<int> language-index: 0;
    in-out property<string> work-dir: "";

    callback generate-keys();
    callback encrypt-text(string);
    callback decrypt-text(string);
    callback save-keys();
    callback load-keys();
    callback save-ciphertext-bin();
    callback get-ciphertext-list();
    callback load-ciphertext-file(string);

    // File callbacks
    callback select-source-file();
    callback select-cipher-file();
    callback encrypt-file();
    callback decrypt-file();
    callback get-rsa-file-list();

    // Settings callbacks
    callback set-language(int);
    callback select-work-dir();
    callback apply-work-dir();

    TabWidget {
        Tab {
            title: (root.language-index == 0 ? "Text" : "文本");

            VerticalBox {
                padding: 15px;
                spacing: 10px;

                // Status bar
                Text {
                    text: status;
                    color: has-keys ? #2e7d32 : #c62828;
                    horizontal-alignment: center;
                }

                // Key management buttons
                HorizontalBox {
                    spacing: 10px;
                    Button {
                        text: (root.language-index == 0 ? "Generate Keys" : "生成密钥");
                        clicked => { root.generate-keys(); }
                    }
                    Button {
                        text: (root.language-index == 0 ? "Save Keys" : "保存密钥");
                        clicked => { root.save-keys(); }
                        enabled: has-keys;
                    }
                    Button {
                        text: (root.language-index == 0 ? "Load Keys" : "加载密钥");
                        clicked => { root.load-keys(); }
                    }
                }

                // Plaintext and ciphertext inputs side by side
                HorizontalBox {
                    spacing: 10px;
                    GroupBox {
                        title: (root.language-index == 0 ? "Plaintext" : "明文");
                        TextEdit {
                            text <=> root.plaintext;
                            placeholder-text: (root.language-index == 0 ? "Enter text to encrypt" : "输入要加密的文本");
                            wrap: word-wrap;
                        }
                    }
                    GroupBox {
                        title: (root.language-index == 0 ? "Ciphertext (Base64)" : "密文 (Base64)");
                        TextEdit {
                            text <=> root.ciphertext;
                            placeholder-text: (root.language-index == 0 ? "Enter Base64 ciphertext to decrypt" : "输入要解密的Base64密文");
                            wrap: word-wrap;
                        }
                    }
                }

                // Preview status hint with switch
                HorizontalBox {
                    spacing: 10px;
                    Text {
                        text: (root.language-index == 0 ? "Preview:" : "预览:");
                        font-weight: 700;
                    }
                    Switch {
                        checked <=> root.preview-enabled;
                    }
                    Text {
                        text: root.preview-status;
                        color: root.preview-status != "" ? #2e7d32 : #666666;
                        font-size: 12px;
                    }
                }

                // Action buttons
                HorizontalBox {
                    spacing: 10px;
                    Button {
                        text: (root.language-index == 0 ? "Encrypt >" : "加密 >");
                        clicked => { root.encrypt-text(root.plaintext); }
                        enabled: has-keys && plaintext != "";
                    }
                    Button {
                        text: (root.language-index == 0 ? "Save Ciphertext" : "保存密文");
                        clicked => { root.save-ciphertext-bin(); }
                    }
                    Button {
                        text: (root.language-index == 0 ? "Refresh List" : "刷新列表");
                        clicked => { root.get-ciphertext-list(); }
                    }
                    Button {
                        text: (root.language-index == 0 ? "Load Ciphertext" : "加载密文");
                        clicked => {
                            if (root.ciphertext-items.length > 0) {
                                root.load-ciphertext-file(root.ciphertext-items[root.ciphertext-items.length - 1].text);
                            }
                        }
                        enabled: has-keys && ciphertext-items.length > 0;
                    }
                    Button {
                        text: (root.language-index == 0 ? "< Decrypt" : "< 解密");
                        clicked => { root.decrypt-text(root.ciphertext); }
                        enabled: has-keys && ciphertext != "";
                    }
                }

                // Ciphertext file list
                Text {
                    text: (root.language-index == 0 ? "Saved ciphertext files:" : "已保存的密文文件:");
                }
                StandardListView {
                    model: ciphertext-items;
                    height: 100px;
                }
            }
        }

        Tab {
            title: (root.language-index == 0 ? "File" : "文件");

            VerticalBox {
                padding: 15px;
                spacing: 10px;

                // Status bar
                Text {
                    text: status;
                    color: has-keys ? #2e7d32 : #c62828;
                    horizontal-alignment: center;
                }

                // Key management buttons
                HorizontalBox {
                    spacing: 10px;
                    Button {
                        text: (root.language-index == 0 ? "Generate Keys" : "生成密钥");
                        clicked => { root.generate-keys(); }
                    }
                    Button {
                        text: (root.language-index == 0 ? "Save Keys" : "保存密钥");
                        clicked => { root.save-keys(); }
                        enabled: has-keys;
                    }
                    Button {
                        text: (root.language-index == 0 ? "Load Keys" : "加载密钥");
                        clicked => { root.load-keys(); }
                    }
                }

                // Divider
                HorizontalBox {
                    Rectangle { height: 1px; background: #cccccc; }
                }

                // Source file selection
                Text {
                    text: (root.language-index == 0 ? "Source File:" : "源文件:");
                    font-weight: 700;
                }
                HorizontalBox {
                    spacing: 10px;
                    Button {
                        text: (root.language-index == 0 ? "Select File" : "选择文件");
                        clicked => { root.select-source-file(); }
                    }
                    Text {
                        text: root.selected-file;
                        color: root.selected-file != "" ? #333333 : #999999;
                        vertical-alignment: center;
                    }
                }

                // Source file info
                Text {
                    text: root.file-info;
                    color: root.file-info != "" ? #666666 : #cccccc;
                    font-size: 12px;
                }

                // Encrypt button
                HorizontalBox {
                    Button {
                        text: (root.language-index == 0 ? "Encrypt ->" : "加密 ->");
                        clicked => { root.encrypt-file(); }
                        enabled: has-keys && root.selected-file != "";
                    }
                }

                // Divider
                HorizontalBox {
                    Rectangle { height: 1px; background: #cccccc; }
                }

                // Cipher file selection
                Text {
                    text: (root.language-index == 0 ? "Encrypted File:" : "加密文件:");
                    font-weight: 700;
                }
                HorizontalBox {
                    spacing: 10px;
                    Button {
                        text: (root.language-index == 0 ? "Select Cipher" : "选择密文");
                        clicked => { root.select-cipher-file(); }
                    }
                    Button {
                        text: (root.language-index == 0 ? "Refresh" : "刷新");
                        clicked => { root.get-rsa-file-list(); }
                    }
                    Text {
                        text: root.selected-cipher;
                        color: root.selected-cipher != "" ? #333333 : #999999;
                        vertical-alignment: center;
                    }
                }

                // RSA file list
                StandardListView {
                    model: rsa-file-items;
                    height: 80px;
                }

                // Decrypt button
                HorizontalBox {
                    Button {
                        text: (root.language-index == 0 ? "<- Decrypt" : "<- 解密");
                        clicked => { root.decrypt-file(); }
                        enabled: has-keys && root.selected-cipher != "";
                    }
                }

                // Divider
                HorizontalBox {
                    Rectangle { height: 1px; background: #cccccc; }
                }

                // Progress bar
                HorizontalBox {
                    visible: root.progress-value > 0 && root.progress-value < 1;
                    spacing: 0;
                    Rectangle {
                        height: 20px;
                        background: #e0e0e0;
                        border-radius: 10px;
                        Rectangle {
                            x: 0;
                            y: 0;
                            width: root.progress-value * 300px;
                            height: 20px;
                            background: #4caf50;
                            border-radius: 10px;
                        }
                    }
                }
                Text {
                    text: root.file-progress;
                    color: root.file-progress != "" ? #2e7d32 : #666666;
                    font-size: 12px;
                }
                Text {
                    text: root.file-status;
                    color: root.file-status != "" ? #2e7d32 : #cccccc;
                    font-size: 12px;
                    horizontal-alignment: center;
                }
            }
        }

        Tab {
            title: (root.language-index == 0 ? "Settings" : "设置");

            VerticalBox {
                padding: 15px;
                spacing: 15px;

                // Status bar
                Text {
                    text: status;
                    color: has-keys ? #2e7d32 : #c62828;
                    horizontal-alignment: center;
                }

                // Language setting
                HorizontalBox {
                    spacing: 10px;
                    Text {
                        text: (root.language-index == 0 ? "Language:" : "语言:");
                        font-weight: 700;
                        vertical-alignment: center;
                    }
                    ComboBox {
                        model: ["English", "中文"];
                        current-value: (root.language-index == 0 ? "English" : "中文");
                        current-index: root.language-index;
                        selected(value) => {
                            root.language-index = (value == "English" ? 0 : 1);
                            root.set-language(root.language-index);
                        }
                    }
                }

                // Preview setting
                HorizontalBox {
                    spacing: 10px;
                    Text {
                        text: (root.language-index == 0 ? "Preview enabled:" : "预览已启用:");
                        vertical-alignment: center;
                    }
                    Switch {
                        checked <=> root.preview-enabled;
                    }
                }

                // Work directory setting
                HorizontalBox {
                    spacing: 10px;
                    Text {
                        text: (root.language-index == 0 ? "Work directory:" : "工作目录:");
                        font-weight: 700;
                        vertical-alignment: center;
                    }
                }
                HorizontalBox {
                    spacing: 10px;
                    Button {
                        text: (root.language-index == 0 ? "Browse" : "浏览");
                        clicked => { root.select-work-dir(); }
                    }
                    Button {
                        text: (root.language-index == 0 ? "Apply" : "应用");
                        clicked => { root.apply-work-dir(); }
                        enabled: root.work-dir != "";
                    }
                }
                Text {
                    text: root.work-dir;
                    color: root.work-dir != "" ? #333333 : #999999;
                    font-size: 12px;
                    horizontal-alignment: left;
                }

                // Divider
                HorizontalBox {
                    Rectangle { height: 1px; background: #cccccc; }
                }

                // Key management buttons
                HorizontalBox {
                    spacing: 10px;
                    Button {
                        text: (root.language-index == 0 ? "Generate Keys" : "生成密钥");
                        clicked => { root.generate-keys(); }
                    }
                    Button {
                        text: (root.language-index == 0 ? "Save Keys" : "保存密钥");
                        clicked => { root.save-keys(); }
                        enabled: has-keys;
                    }
                    Button {
                        text: (root.language-index == 0 ? "Load Keys" : "加载密钥");
                        clicked => { root.load-keys(); }
                    }
                }

                // Divider
                HorizontalBox {
                    Rectangle { height: 1px; background: #cccccc; }
                }

                // About
                Text {
                    text: (root.language-index == 0 ? "RSA GUI v0.1.0" : "RSA GUI v0.1.0");
                    font-size: 14px;
                    font-weight: 700;
                }
                Text {
                    text: (root.language-index == 0 ? "Pure RSA file encryption" : "纯 RSA 文件加密");
                    font-size: 12px;
                    color: #666666;
                }
                Text {
                    text: (root.language-index == 0 ? "Expansion rate: ~1.35x" : "膨胀率: ~1.35倍");
                    font-size: 12px;
                    color: #666666;
                }
            }
        }
    }
}
